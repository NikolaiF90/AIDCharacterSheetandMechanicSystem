# CSMS Milestones

## Phase 1 â€” Foundation âœ… COMPLETE

### Goals
- Basic character sheet creation and display
- Multi-character support (player + NPCs)
- Command parser
- NotifyThem notification system
- Clean Library architecture

### Completed
- [x] `/csms create [name]` â€” creates character, first is player, rest are NPCs
- [x] `/csms stats [name]` â€” refreshes story card display
- [x] `/csms reset [name]` â€” removes specific character
- [x] `/csms reset` â€” removes all characters
- [x] `/csms cleanup` â€” removes orphaned story cards
- [x] `state.characters[]` array â€” multi-character storage
- [x] Individual story cards per character titled `ðŸ“‹ Name`
- [x] Case-insensitive name handling everywhere
- [x] `storedName` fix â€” card removal uses actual stored name not typed input
- [x] NotifyThem â€” bracketed notifications, debug logging, timestamps
- [x] `CSMS_CONFIG` and `NOTIFY_CONFIG` â€” world maker configuration
- [x] Regex command detection anywhere in player input (do/say/normal)
- [x] Punctuation stripping from command params

### Architecture
- Library tab â€” all logic (CSMS + NotifyThem)
- Input/Context/Output tabs â€” single line each calling `CSMS(hook)`
- `state.characters[]` â€” persistent character storage
- `storyCards[]` â€” display layer, synced to state

---

## Phase 1.5 â€” Quality of Life âœ… COMPLETE

### Goals
- Editable stats from story card UI
- Multiplayer compatibility
- `canCastSpell` flag
- Context injection system

### Completed
- [x] `/csms sync [name]` â€” manual sync story card edits to state
- [x] `parseCharacterCard()` â€” position-based parser, label-agnostic regex
- [x] `safeInt()` â€” validation with fallback and error notification
- [x] Auto-sync on every context hook
- [x] `canCastSpell: false` flag â€” added to `initCharacter()`
- [x] `STAT_MIN` and `STAT_MAX` in `CSMS_CONFIG`
- [x] `BANNED_NAMES` â€” prevents invalid names like "You", "Adventurer"
- [x] Empty string guard â€” prevents blank auto-create from empty `info.characters` entries
- [x] `injectActiveCharacters()` â€” compact sheet injection into frontMemory
- [x] `LOOKBACK_ACTIONS` and `INJECTED_SHEET_MAX` in `CSMS_CONFIG`
- [x] Multiplayer auto-create â€” sheets created on join via `info.characters`
- [x] `getActivePlayer()` â€” detects active player from input text in multiplayer
- [x] `isMultiplayerCharacter` flag â€” protects NPCs from multiplayer sync
- [x] `syncMultiplayerCharacters()` â€” removes sheets for players who left or renamed
- [x] SC keyword placeholder `csms_cs_${name}` â€” AC-safe card trigger keys

---

## Phase 2 â€” Tag System âœ… COMPLETE

### Goals
- `[CSMS] CharacterName` tag on existing story cards
- Lazy load â€” only generate sheet when name appears in recent history
- AI reads card entry, determines appropriate stats
- Remove tag from original card after sheet generated

### Completed
- [x] `getTaggedCards()` â€” scans storyCards for AUTO_GENERATION_TAG prefix
- [x] `getTaggedName()` â€” extracts clean name from tagged card title, strips emoji too
- [x] `isCharacterSheet()` â€” identifies valid CS cards by emoji OR csms_cs_ key
- [x] `processTaggedCards()` â€” full detection and branching logic in context hook
- [x] `generateNarrativeSheet()` â€” output hook intercepts AI stat response
- [x] Three-branch logic â€” separate CS exists / tagged card IS CS / no CS anywhere
- [x] `state.csmsPending` â€” single-item queue for AI generation, one character at a time
- [x] Stats stripped from visible output â€” player never sees raw stat response
- [x] Tag removed from original card after sheet generated
- [x] `AUTO_GENERATION_TAG` in `CSMS_CONFIG` â€” world maker configurable
- [x] Case-insensitive tag matching

### Known Limitations
- New card requires one extra action to appear in UI â€” AID rendering quirk, not a bug
- Multiple tagged cards process one per action â€” intentional, AI generation is sequential

---

## Phase 3 â€” Roll System ðŸ“‹ PLANNED

### Goals
- Dice rolling with stat modifiers
- DC checks (success/fail)
- Player explicit roll commands
- AI signals rolls via output tags

### Tasks
- [ ] `/csms roll [dice]` â€” explicit roll command
- [ ] AI output tag detection `[ROLL:1d20+STR]`
- [ ] Stat modifier calculation and application
- [ ] DC threshold check â€” script determines success/fail
- [ ] Result injection â€” script feeds result back, AI narrates
- [ ] Proficiency bonus application

---

## Phase 4 â€” Combat ðŸ“‹ PLANNED

### Goals
- Damage application
- HP tracking
- Death/injury states
- AC-based hit detection

### Tasks
- [ ] AI output tag `[DAMAGE:name:amount]`
- [ ] AI output tag `[HEAL:name:amount]`
- [ ] HP update and story card sync
- [ ] Death threshold detection
- [ ] Injury states (narrative flags for AI)
- [ ] AC vs attack roll comparison

---

## Phase 5 â€” Feats ðŸ“‹ PLANNED

### Goals
- Natural language feat cards
- AI interprets and executes feats
- Script tracks ownership and cooldowns

### Tasks
- [ ] Feat story card format
- [ ] `/csms feat add [name]` â€” assign feat to character
- [ ] Feat injection into context when relevant
- [ ] Cooldown tracking in state
- [ ] One-time use feat handling

---

## Backlog / Future Ideas

- NotifyThem as standalone published system
- PE template integration â€” read player-filled Plot Essentials template, auto-generate sheet
- `/csms setplayer [name]` â€” reassign who is the player character
- `/csms debug [on/off]` â€” player toggleable debug mode
- Inventory system
- Status effects / conditions
- XP and leveling system
- Proficiency bonus auto-scaling with level
- Spell slot tracking (if `canCastSpell: true`)
- World maker scenario templates
